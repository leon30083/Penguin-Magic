### 自动化开发流程
- 用户想以企鹅工坊原项目为底座，在其基础上进行二次开发，现在需要先制定AI自动化开发流程，仔细阅读“D:\user\github\Penguin-Magic\.dev-docs\vibe-coding-cn-main”，按照其中的规范，首先对项目进行自动化开发初始化，制定合理的自动化开发规范。
- 在自动化规则中，必须明确始终使用中文和用户沟通；
- 这个文件平中包含二次开发的预分析文档，供你参考，可能并不完全正确：“D:\user\github\Penguin-Magic\.dev-docs”
- 在自动化规则中，必须明确对话上下文大小处理方式，避免上下文超出模型最大限制。用户使用GLM4.7，以下是经过实践的管理方式：
```
  ---
  5. 上下文控制规范 ⭐⭐⭐ 新增 (2026-01-20)

  重要性: 防止对话超出上下文长度限制（API Error 1210），确保开发过程顺利进行

  ---
  5.1 上下文长度限制

  错误示例: API Error: 1210 - Request input tokens exceeds the model's maximum context length

  限制原因:
  - 模型最大上下文: 200,000 tokens (约175,000字符)
  - 每次请求都会累积对话历史
  - 长代码读取、详细分析会快速消耗上下文

  ---
  5.2 上下文控制策略

  ✅ 必须遵守的规则:

  1. 限制单次返回长度

  - Read工具: 使用 offset + limit 分段读取（每次最多500行）
  - Grep工具: 使用 head_limit 限制结果数量（默认50条）
  - 分析输出: 限制详细分析长度（最多1000字符）

  2. 优先使用专用工具

  - ❌ 避免: 长篇读取后用自然语言总结（消耗大量token）
  - ✅ 推荐: 使用 Task agent 的 Explore 模式探索代码库
  - ✅ 推荐: 使用 Grep 工具快速定位代码

  3. 减少重复读取

  - ✅ 一次性读取: 相邻文件用一次 Read 调用（offset + limit 连续范围）
  - ✅ 缓存机制: 读取过的文件缓存结果，避免重复读取
  - ❌ 避免: 多次读取同一文件的不同部分

  4. 简洁的响应

  - ✅ 简洁总结: 用"已完成文件1、2、3"代替详细罗列
  - ✅ 链接引用: 使用文件路径和行号代替完整代码引用
  - ❌ 避免: 大段代码块粘贴（用路径+行号替代）

  5. 定期清理上下文

  - ✅ 新任务开始前: 总结上一阶段成果（100-200字符）
  - ✅ 长对话中断: 建议开启新对话继续
  - ✅ 关键信息保留: 未完成任务列表、重要发现

  ---
  5.3 示例对比

  ❌ 错误做法:
  # 消耗大量token的操作
  User: "分析 CanvasNode.tsx 的完整实现"
  Claude: [读取2835行代码] [详细分析每个函数] [返回超长总结]  # ❌ 超出限制

  User: "现在分析 Sidebar.tsx"
  Claude: [重复读取] [再次超长总结]  # ❌ 累积超出限制

  ✅ 正确做法:
  # 节省token的操作
  User: "分析 CanvasNode.tsx 中的 Sora2 节点实现"
  Claude: [使用 Grep: "renderSora2" node.data -A 5]  # ✅ 精准定位
  Claude: "找到4个渲染函数，位于行762-1973，包括参考图、批量生成、提示词优化和角色创建节点"

  User: "查看 Sidebar.tsx 中的 Sora2 按钮"
  Claude: [使用 Grep: "sora2-" -B 2 -A 2]  # ✅ 精准定位
  Claude: "找到8个按钮，位于行168-175，包括API配置、角色库、参考图..."

  ---
  5.4 工具使用优先级
  ┌───────────────┬────────────────┬───────────┐
  │     工具      │    使用场景    │ Token消耗 │
  ├───────────────┼────────────────┼───────────┤
  │ Grep          │ 精准搜索代码   │ 低 ⭐⭐   │
  ├───────────────┼────────────────┼───────────┤
  │ Glob          │ 查找文件路径   │ 低 ⭐⭐   │
  ├───────────────┼────────────────┼───────────┤
  │ Read (分段)   │ 读取已知位置   │ 中 ⭐⭐   │
  ├───────────────┼────────────────┼───────────┤
  │ Explore Agent │ 探索未知代码库 │ 中 ⭐⭐   │
  ├───────────────┼────────────────┼───────────┤
  │ Read (全文件) │ 小文件(<500行) │ 高 ⚠️     │
  ├───────────────┼────────────────┼───────────┤
  │ 自然语言分析  │ 总结复杂逻辑   │ 高 ⚠️     │
  └───────────────┴────────────────┴───────────┘
  ---
  5.5 紧急处理措施

  遇到 1210 错误时:
  1. 立即中断: 停止当前的长内容返回
  2. 开启新对话: "建议开启新对话以继续此任务"
  3. 关键信息保留: 任务列表、文件位置、已完成工作
  4. 继续任务: 在新对话中引用 文件:line_number 格式继续

  检测信号:
  - 响应明显变慢
  - 分析结果截断
  - 系统提示 "Request input tokens exceeds..."

  ---
  5.6 Claude Code 行为规范

  自动遵守规则:
  - ✅ 使用 head_limit 参数限制 Grep 结果
  - ✅ 使用 offset + limit 分段读取大文件
  - ✅ 优先使用 Task agent 处理复杂探索
  - ✅ 分析输出控制在1000字符以内

  无需手动干预:
  - ✅ Grep 默认限制50条结果
  - ✅ Read 大文件自动建议分段
  - ✅ Explore agent 自动优化token使用

  ---
  关键要点总结
  ┌──────────┬───────────────────────────────────────────────┐
  │   策略   │                     说明                      │
  ├──────────┼───────────────────────────────────────────────┤
  │ 精准定位 │ 使用 Grep + head_limit 快速定位代码           │
  ├──────────┼───────────────────────────────────────────────┤
  │ 分段读取 │ 大文件使用 offset + limit 分段读取            │
  ├──────────┼───────────────────────────────────────────────┤
  │ 简洁响应 │ 避免大段代码块，用路径+行号替代               │
  ├──────────┼───────────────────────────────────────────────┤
  │ 工具优先 │ Grep > Glob > Read(分段) > Explore > 自然语言 │
  ├──────────┼───────────────────────────────────────────────┤
  │ 定期清理 │ 新任务前总结，长对话中断时开启新对话          │
  └──────────┴───────────────────────────────────────────────┘
  ---
  这套上下文控制规范是针对 **API Error 1210（上下文超限）**问题的完整解决方案，确保在长期开发对话中能够高效使用 token，避免对话中断。
```

### skill 技能
- 可能用到的skill存放在：“D:\user\github\Penguin-Magic\.dev-docs\可能会用到的skill”，请在初始化项目时，将这些skill复制到claude可调用的标准skill目录中。

### 功能实现
- 用户想增加的功能有：
    - GLM编程套餐接入，功能等再吃Penguin-Magic中现有的gemini模型。
    - 接入聚鑫平台，功能等同于Penguin-Magic中现在的t8平台【贞贞平台】。
