---
name: character-workflow
description: 角色管理工作流功能需求。当需要创建、管理和使用 Sora2 角色时使用此 skill。
---

# 角色管理工作流功能需求

> **重要**: 这是一份需求说明书，不是技术文档。
> **目的**: 说明如何使用 Penguin-Magic 现有节点实现角色创建和管理功能。

---

## 功能概述

**角色系统**: Sora2 的核心功能之一，允许用户从已生成的视频中提取角色，并在新视频中重复使用。

**核心价值**:
- ✅ 内容复用：一次创建，多次使用
- ✅ 角色一致：保持角色在不同视频中的外观一致
- ✅ 跨平台通用：聚鑫和贞贞平台共享角色库
- ✅ 易于管理：搜索、收藏、筛选角色

---

## 完整用户旅程

### 第一步：从视频创建角色

**用户操作**: 使用 `sora2-character-create` 节点从视频提取角色

**输入需求**:
- **来源任务 ID**: 已生成视频的任务 ID（推荐）
- **时间范围**: 1-3 秒片段（如 `"1,3"`）
- **替代方案**: 视频文件 URL（不推荐）

**系统处理**:
1. 从指定时间段提取角色帧
2. 生成角色缩略图
3. 分配唯一用户名（如 `ebfb9a758.sunnykitte`）
4. 保存到角色库

**输出**:
- **角色 ID**: 系统生成的唯一标识
- **用户名**: 真实 ID（用于 API 调用）
- **缩略图**: 角色头像 URL

---

### 第二步：设置角色别名

**用户操作**: 在 `sora2-character-lib` 节点为角色设置易记的别名

**示例**:
- 用户名：`ebfb9a758.sunnykitte`（真实 ID）
- 别名：`阳光小猫`（用户友好）

**双显示机制**:
- **输入框显示**: `@阳光小猫`（别名，易读）
- **API 使用**: `@ebfb9a758.sunnykitte`（真实 ID，准确）

**用户价值**:
- 用户看到友好名称（阳光小猫）
- API 使用准确标识（ebfb9a758.sunnykitte）
- 避免混淆（多个角色可能有相似别名）

---

### 第三步：在视频中使用角色

**用户操作**: 在 `sora2-video-generate` 节点使用 `@username` 语法引用角色

**引用方式**:
```
@阳光小猫 在海边玩
```

**系统自动转换**:
- 输入框显示：`@阳光小猫`
- API 实际使用：`@ebfb9a758.sunnykitte`

**生成结果**:
- 角色出现在指定场景中
- 角色保持原始外观（颜色、形状、特征）
- 角色执行指定动作

---

## 节点组合方案

### 核心节点

| 节点 | 用途 | 说明 |
|------|------|------|
| **sora2-video-generate** | 生成基础视频 | 用于提取角色 |
| **sora2-character-create** | 从视频提取角色 | 核心功能 |
| **sora2-character-lib** | 管理角色库 | 角色管理 |
| **sora2-video-generate** | 使用角色生成新视频 | 角色引用 |

---

### 完整工作流图

```
sora2-video-generate（生成基础视频）
    ↓
sora2-character-create（从视频提取角色）
    ↓
sora2-character-lib（管理角色库）
    ↓
sora2-video-generate（使用角色生成新视频）
```

**数据流**:
1. 生成基础视频 → 获得任务 ID
2. 从任务 ID 提取角色 → 保存到角色库
3. 从角色库选择角色 → 在新视频中使用

---

## 用户场景

### 场景 1：内容创作者

**用户需求**: 制作多个视频，保持角色一致

**使用流程**:
1. 生成视频："橙色小猫在花园玩" → 获得任务 ID
2. 提取角色：from_task=video_xxx, timestamps="1,3" → 创建角色
3. 设置别名：`ebfb9a758.sunnykitte` → `阳光小猫`
4. 生成新视频 1："@阳光小猫 在海边追逐海鸥"
5. 生成新视频 2："@阳光小猫 在森林里探索"

**用户价值**:
- ✅ 角色在所有视频中保持一致
- ✅ 无需重新描述角色外观
- ✅ 快速创建多个相关视频

---

### 场景 2：宠物爱好者

**用户需求**: 从宠物视频创建角色，制作个性化视频

**使用流程**:
1. 上传宠物视频 → 生成视频任务
2. 提取角色：from_task=video_xxx, timestamps="1,3"
3. 设置别名：真实名字（如"球球"）
4. 生成个性化视频："@球球 在公园玩飞盘"
5. 生成节日视频："@球球 戴着圣诞帽过节"

**用户价值**:
- ✅ 将宠物变成动画角色
- ✅ 制作个性化视频内容
- ✅ 分享到社交媒体

---

### 场景 3：品牌营销

**用户需求**: 创建品牌吉祥物角色，在广告视频中重复使用

**使用流程**:
1. 设计吉祥物视频 → 生成视频任务
2. 提取角色：from_task=video_xxx, timestamps="1,3"
3. 设置别名：品牌名称（如"酷酷熊"）
4. 生成产品广告 1："@酷酷熊 介绍新功能"
5. 生成产品广告 2："@酷酷熊 在促销活动中"

**用户价值**:
- ✅ 建立品牌形象
- ✅ 保持品牌一致性
- ✅ 降低制作成本（重复使用角色）

---

## 功能需求

### 1. 角色创建功能

**功能描述**: 从已生成的视频提取角色

**输入需求**:
- **来源任务 ID**: 使用 `from_task` 参数（推荐）
- **时间范围**: 1-3 秒片段
- **替代方案**: 视频文件 URL（不推荐）

**输出需求**:
- **角色 ID**: 系统生成的唯一标识
- **用户名**: 真实 ID（如 `ebfb9a758.sunnykitte`）
- **缩略图**: 角色头像 URL

**约束条件**:
- ⚠️ 时间范围必须是 1-3 秒
- ⚠️ 视频中的角色必须是物品/宠物
- ❌ 不支持真人人物（需要 face ID 录入，暂未开放）

**用户价值**:
- 一次创建，多次使用
- 保持角色一致性
- 降低制作成本

---

### 2. 角色引用功能

**功能描述**: 在视频生成中使用已创建的角色

**引用语法**:
- 格式：`@username`（不带花括号）
- 示例：`@阳光小猫 在海边玩`

**双显示机制**:
- **输入框显示**: `@阳光小猫`（别名）
- **API 实际使用**: `@ebfb9a758.sunnykitte`（真实 ID）

**关键原则**:
- ✅ 使用角色引用时，**不需要描述角色外观**
- ✅ 只需要描述角色在场景中的**动作、互动、位置**
- ✅ Sora2 会自动使用角色的真实外观

**正确示例**:
```
@阳光小猫 在海边欢快地追逐蝴蝶，跳跃着探索每一处角落
```

**错误示例**:
```
@阳光小猫 一只橘色的猫咪，有着绿色的大眼睛和粉色的鼻子，在海边玩耍
❌ 问题：描述了外观，AI可能忽略角色引用
```

---

### 3. 角色库管理功能

**功能描述**: 查看、搜索、筛选和管理角色

**核心功能**:
- **浏览**: 卡片式展示所有角色（头像 + 别名）
- **搜索**: 按别名或用户名搜索
- **筛选**: 全部 / 收藏 / 最近使用
- **收藏**: 标记常用角色（星标）
- **删除**: 移除不需要的角色
- **多选**: 支持选择多个角色传递给视频节点

**用户价值**:
- 集中管理所有角色
- 快速找到需要的角色
- 高效复用角色

---

## 验收标准

### 功能完整性

- [ ] 角色创建功能正常
- [ ] 角色引用功能正常
- [ ] 角色库管理功能正常
- [ ] 双显示功能正常

### 用户体验

- [ ] 角色创建流程顺畅
- [ ] 角色引用直观易用
- [ ] 角色库管理高效
- [ ] 别名设置灵活

### 角色一致性

- [ ] 角色在不同视频中保持外观一致
- [ ] 角色引用自动转换为真实 ID
- [ ] 双显示机制无错误

### 跨平台兼容性

- [ ] 聚鑫创建的角色可在贞贞使用
- [ ] 贞贞创建的角色可在聚鑫使用
- [ ] 角色数据格式统一

---

## 最佳实践

### 角色创建技巧

**✅ 推荐做法**:
- 选择角色出现的最佳片段（1-3秒）
- 确保角色清晰可见（正面、无遮挡）
- 选择有特征性的片段（便于识别）
- 测试角色提取效果（先创建，再使用）

**❌ 避免**:
- 时间范围超出 1-3 秒
- 角色被遮挡或模糊
- 时间范围选择不当（角色未出现）

---

### 角色引用技巧

**✅ 推荐做法**:
- 在提示词开头使用角色引用
- 描述角色在场景中的动作和活动
- 多角色场景使用 `和` / `与` 连接

**示例**:
```
@阳光小猫 和 @测试小猫 在海边一起玩耍
@阳光小猫 在左边追逐蝴蝶，@测试小猫 在右边睡觉
```

**❌ 避免**:
- 描述角色外观（"一只橘色的猫咪..."）
- 在提示词中间插入角色引用
- 使用花括号（`@{username}` 格式错误）

---

### 角色管理技巧

**高效管理**:
- 为角色设置易记的别名
- 收藏常用角色（快速访问）
- 定期清理不需要的角色
- 使用搜索功能快速定位角色

**多角色使用**:
- 在 `sora2-character-lib` 节点多选角色
- 传递给 `sora2-video-generate` 节点
- 在提示词中使用 `@角色A 和 @角色B` 语法

---

## 参考文档

- `references/character-creation.md` - 角色创建详细流程
- `references/character-reference.md` - 角色引用详细规范
- `../penguin-nodes-guide/SKILL.md` - Penguin 节点复用指南

---

**文档版本**: v1.0
**创建日期**: 2026-01-21
**维护者**: WinJin 开发团队
