---
name: storyboard-workflow
description: 故事板工作流功能需求。当需要使用故事板功能制作多镜头视频时使用此 skill。
---

# 故事板工作流功能需求

> **重要**: 这是一份需求说明书，不是技术文档。
> **目的**: 说明故事板功能的需求和用户场景，这是 Penguin-Magic 当前未实现的功能。

---

## 功能概述

**故事板**: 通过多个镜头拼接生成一个连贯的视频，每个镜头有独立的场景描述和时长。

**核心价值**:
- ✅ 连贯叙事：制作有剧情的动画短片
- ✅ 精细控制：控制每个镜头的内容和时长
- ✅ 风格统一：所有镜头保持一致的动画风格

**⚠️ 重要**: 这是 Penguin-Magic **当前未实现**的功能，需要新增。

---

## 什么是故事板？

### 定义

**故事板**是一种视频创作方式，通过将多个独立的镜头（shots）按顺序拼接，生成一个完整的连贯视频。

**与批量生成的区别**:
| 维度 | 故事板 | 批量生成 |
|------|-------|---------|
| **输出** | **单个视频**（多镜头拼接） | **多个视频**（独立任务） |
| **镜头关系** | 镜头按顺序拼接 | 每个镜头独立视频 |
| **叙事连贯性** | ✅ 连贯的故事线 | ❌ 独立场景 |
| **用途** | 动画短片、广告 | 批量内容生成 |

**示例**:
```
故事板 = 1个视频（包含3个镜头）
批量生成 = 3个独立的视频

镜头1 → 镜头2 → 镜头3 → 完整视频
视频A | 视频B | 视频C | （3个独立文件）
```

---

### 用户价值

**1. 讲述完整故事**
- 镜头按时间顺序排列
- 形成完整的故事线
- 适合短片制作

**2. 精细控制视频内容**
- 每个镜头独立描述
- 精确控制每个场景
- 灵活调整镜头顺序

**3. 提升创作效率**
- 一次性提交多个镜头
- 系统自动拼接
- 节省后期剪辑工作

---

## 核心功能需求

### 1. 镜头管理功能

**功能描述**: 创建、编辑、删除镜头

**镜头参数**:
- **序号**: 镜头在故事板中的位置（1, 2, 3...）
- **场景描述**: 文字描述镜头内容
- **时长**: 镜头持续时间（如 5 秒、10 秒）
- **参考图**: 可选，为镜头添加参考图片
- **角色引用**: 可选，在镜头中使用 `@username` 语法

**用户操作**:
- **添加镜头**: 创建新的镜头到故事板末尾
- **编辑镜头**: 修改镜头的场景描述、时长、参考图
- **删除镜头**: 移除不需要的镜头
- **调整顺序**: 重新排列镜头顺序

---

### 2. 参考图支持功能

**功能描述**: 为故事板或镜头添加参考图片

**参考图类型**:
- **全局参考图**: 所有镜头共享的参考图
- **镜头参考图**: 单独为某个镜头添加的参考图

**图片合并策略**:
1. **优先级**: 镜头参考图 > 全局参考图
2. **合并方式**: 所有参考图合并传递给 API
3. **用途**: 统一视频风格，精确控制场景

**用户场景**:
- 全局参考图：统一所有镜头的背景风格（如卡通森林背景）
- 镜头参考图：为特定镜头添加独特元素（如某个角色或道具）

---

### 3. 角色引用功能

**功能描述**: 在镜头中使用已创建的角色

**引用方式**:
- 语法：`@username`（不带花括号）
- 示例：`@装载机 在工地中央搬运石头`

**跨镜头一致性**:
- 角色在多个镜头中保持外观一致
- 角色在不同场景中活动
- 角色与场景正确融合

**用户价值**:
- 制作角色主导的动画短片
- 保持角色连贯性
- 降低角色制作成本

---

## 双平台差异

### 聚鑫平台故事板

**特点**:
- ✅ 专用故事板端点：`POST /v1/videos`
- ✅ Content-Type：`multipart/form-data`
- ✅ 提示词格式：拼接为字符串数组

**提示词格式**:
```javascript
shots: [
  {
    prompt: "Shot 1:\nduration: 5sec\nScene: 老鹰展翅高飞"
  },
  {
    prompt: "Shot 2:\nduration: 5sec\nScene: 老鹰在空中盘旋"
  }
]
```

---

### 贞贞平台故事板

**特点**:
- ❌ 无专用端点：使用常规视频端点
- ✅ Content-Type：`application/json`
- ✅ 提示词格式：多行文本，特殊格式

**提示词格式**:
```
Shot 1:
duration: 5sec
Scene: 老鹰展翅高飞

Shot 2:
duration: 5sec
Scene: 老鹰在空中盘旋
```

---

## 用户场景

### 场景 1：制作动画短片

**用户需求**: 制作一个 30 秒的动画短片，讲述一个完整故事

**故事板设计**:
- 镜头 1（10秒）：主角介绍
- 镜头 2（10秒）：主角活动场景
- 镜头 3（10秒）：高潮或结局

**使用流程**:
1. 在故事板节点创建 3 个镜头
2. 为每个镜头输入场景描述
3. 设置每个镜头的时长（10秒）
4. 可选：添加参考图片和角色引用
5. 提交故事板任务

**预期结果**:
- 1 个完整的 30 秒视频
- 3 个镜头无缝拼接
- 故事连贯流畅

---

### 场景 2：产品广告视频

**用户需求**: 制作一个 15 秒的产品广告，展示产品特点

**故事板设计**:
- 镜头 1（5秒）：产品外观展示
- 镜头 2（5秒）：产品功能演示
- 镜头 3（5秒）：用户使用场景

**使用流程**:
1. 在故事板节点创建 3 个镜头
2. 为每个镜头添加产品参考图
3. 描述每个镜头的内容和重点
4. 提交故事板任务

**预期结果**:
- 1 个专业的 15 秒广告视频
- 产品特点清晰展示
- 画面流畅专业

---

### 场景 3：多角色动画短片

**用户需求**: 制作一个 20 秒的动画短片，展示多个角色的互动

**故事板设计**:
- 镜头 1（7秒）：角色 A 登场
- 镜头 2（7秒）：角色 B 登场
- 镜头 3（6秒）：两个角色互动

**使用流程**:
1. 在故事板节点创建 3 个镜头
2. 在每个镜头中使用角色引用（`@角色A`、`@角色B`）
3. 描述角色在每个镜头中的活动和互动
4. 可选：添加背景参考图
5. 提交故事板任务

**预期结果**:
- 1 个完整的 20 秒视频
- 多个角色自然互动
- 角色外观保持一致

---

## 功能需求规格

### 输入需求

| 参数 | 类型 | 必需/可选 | 说明 |
|------|------|----------|------|
| 镜头列表 | Array | 必需 | 至少包含 2 个镜头 |
| 场景描述 | String | 必需 | 每个镜头的文字描述 |
| 镜头时长 | Integer | 必需 | 每个镜头的时长（秒） |
| 参考图 | Array | 可选 | 全局或镜头级别的参考图片 |
| 角色引用 | String | 可选 | 使用 `@username` 语法 |
| 模型 | String | 可选 | sora-2-all 或 sora-2 / sora-2-pro |
| 画面比例 | String | 可选 | 16:9 或 9:16 |
| 视频时长 | Integer | 可选 | 总视频时长（所有镜头时长之和） |

---

### 输出需求

| 参数 | 类型 | 说明 |
|------|------|------|
| 任务 ID | String | 用于查询视频生成进度 |
| 初始状态 | String | `queued` 或 `processing` |
| 预计时间 | Integer | 分钟（基于总时长和模型） |

---

### 轮询需求

| 参数 | 说明 |
|------|------|
| 轮询间隔 | 30 秒（避免 429 错误） |
| 查询端点 | 根据平台选择 |
| 停止条件 | 状态变为 `success` 或 `failure` |

---

## 验收标准

### 功能完整性

- [ ] 镜头管理功能正常（添加/删除/编辑）
- [ ] 参考图支持功能正常（全局/镜头）
- [ ] 角色引用功能正常（跨镜头一致性）
- [ ] 视频拼接功能正常（镜头无缝连接）

### 用户体验

- [ ] 界面直观易懂
- [ ] 镜头操作灵活
- [ ] 预览功能准确
- [ ] 错误提示友好

### 性能要求

- [ ] 故事板创建时间：< 30 秒
- [ ] 视频生成时间：5-10 分钟（基于总时长）
- [ ] 任务查询响应时间：< 1 秒
- [ ] 支持 429 错误处理

### 双平台支持

- [ ] 聚鑫平台功能正常
- [ ] 贞贞平台功能正常
- [ ] 平台差异透明化处理

---

## 最佳实践

### 故事板设计技巧

**✅ 推荐做法**:
- 每个镜头时长均匀（如 5 秒、10 秒）
- 镜头数量适中（3-5 个镜头）
- 场景描述简洁明了
- 保持叙事连贯性

**❌ 避免**:
- 镜头时长差异过大（如 2 秒 + 20 秒）
- 镜头数量过多（超过 10 个）
- 场景描述过于复杂
- 叙事跳跃不连贯

---

### 参考图使用技巧

**全局参考图**:
- 用于统一背景风格（如森林、海洋、城市）
- 适用于所有镜头
- 减少重复添加图片的工作

**镜头参考图**:
- 用于特定场景（如某个角色或道具）
- 只影响单个镜头
- 优先级高于全局参考图

---

### 角色引用技巧

**跨镜头一致性**:
- 确保角色在所有镜头中引用
- 使用相同的角色别名
- 描述角色在不同镜头中的活动

**多角色互动**:
- 在镜头中使用 `@角色A 和 @角色B` 语法
- 描述角色之间的互动
- 确保角色在场景中合理分布

---

## 实施建议

### 开发优先级

| 阶段 | 功能 | 优先级 | 预估工作量 |
|------|------|--------|----------|
| **P1** | 基础故事板功能 | ⭐⭐⭐ | 3-5 天 |
| **P2** | 参考图支持 | ⭐⭐ | 1-2 天 |
| **P3** | 角色引用集成 | ⭐⭐ | 1-2 天 |
| **P4** | 镜头预览功能 | ⭐ | 0.5-1 天 |

**总工作量**: 6-10 天

---

## 参考文档

- `references/storyboard-concept.md` - 故事板概念说明
- `references/shot-management.md` - 镜头管理功能详情
- `../penguin-nodes-guide/SKILL.md` - Penguin 节点复用指南
- `../juxin-platform/SKILL.md` - 聚鑫平台故事板规范
- `../zhenzhen-platform/SKILL.md` - 贞贞平台故事板规范

---

**文档版本**: v1.0
**创建日期**: 2026-01-21
**维护者**: WinJin 开发团队
