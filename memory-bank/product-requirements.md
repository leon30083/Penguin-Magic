# Penguin-Magic 产品需求文档 (PRD)

> **项目名称**: 企鹅工坊二次开发
> **创建日期**: 2026-01-21
> **文档类型**: 产品需求文档 (PRD)

---

## 1. 项目概述

### 1.1 项目定位

**企鹅工坊（Penguin-Magic）** 是一个基于 ComfyUI 的视频生成工作流平台，用户可以通过可视化节点编辑器创建视频生成工作流。

**当前状态**: 平台已支持 Sora2 模型（贞贞平台），具备完整的视频生成、角色创建、提示词优化等功能。

### 1.2 开发目标

在现有平台基础上，增加以下两个核心功能：

1. **GLM 编程套餐接入**
   - 用于 Chat 对话
   - 用于提示词生成和优化
   - 类似现有 Gemini 模型的功能

2. **聚鑫平台 sora-2-all 模型接入**
   - 用于视频生成
   - 用于角色创建
   - 与现有贞贞平台功能类似

---

## 2. 功能需求

### 2.1 GLM 编程套餐接入

#### 用户场景

**场景 1: Chat 对话**
- 用户输入问题，AI 返回回答
- 支持流式响应
- 支持多轮对话上下文

**场景 2: 提示词生成**
- 用户输入简单描述（如"一只猫在玩"）
- AI 生成详细的视频提示词（如"一只橙色的猫咪在花园里追逐蝴蝶，阳光明媚，画面温馨..."）
- 支持多种风格选择（动画绘本、电影风格、纪录片风格等）

**场景 3: 提示词优化**
- 用户输入已有提示词
- AI 优化提示词质量
- 生成更详细、更生动的描述

#### 功能要求

- [ ] 支持 Chat 对话界面
- [ ] 支持流式响应显示
- [ ] 支持多轮对话历史
- [ ] 支持提示词生成
- [ ] 支持提示词优化
- [ ] 支持风格选择
- [ ] 与现有 Gemini 功能体验一致

### 2.2 聚鑫平台 Sora-2-all 模型接入

#### 用户场景

**场景 1: 文生视频**
- 用户输入提示词
- 选择时长（10秒/15秒）
- 选择比例（16:9横屏/9:16竖屏）
- 系统生成视频

**场景 2: 图生视频**
- 用户上传参考图片
- 输入提示词描述
- 系统基于图片生成视频

**场景 3: 角色创建和引用**
- 从已生成的视频提取角色（如宠物）
- 角色保存到角色库
- 在新视频中使用 `@角色名` 语法引用角色
- 角色在多个视频中保持一致

**场景 4: 批量生成**
- 一次性生成多个视频
- 并行处理，节省时间

#### 功能要求

- [ ] 文生视频功能
- [ ] 图生视频功能
- [ ] 角色创建功能
- [ ] 角色引用功能（@username 语法）
- [ ] 批量生成功能
- [ ] 双平台切换（聚鑫/贞贞）
- [ ] 任务进度显示
- [ ] 错误处理（429 错误自动重试）

---

## 3. 非功能需求

### 3.1 性能要求

- 视频生成时间: 3-5 分钟
- Chat 响应时间: < 1 秒（首字）
- API 调用响应: < 2 秒
- 支持 429 错误处理

### 3.2 用户体验要求

- 界面清晰易懂
- 操作流程顺畅
- 错误提示友好（中文）
- 进度显示准确

### 3.3 代码质量要求

- 模块化设计
- 无单体巨文件
- 代码注释完整（中文）
- 通过测试验证

---

## 4. 技术约束

### 4.1 GLM 编程套餐

- API 端点: `https://open.bigmodel.cn/api/coding/paas/v4`
- 协议: OpenAI 兼容
- 上下文限制: 200,000 tokens

### 4.2 聚鑫平台

- API 端点: `https://api.jxincm.cn`
- 唯一模型: sora-2-all
- 轮询间隔: 30 秒（避免 429 错误）

### 4.3 现有代码库

- 前端: React + TypeScript
- 后端: Node.js
- UI 框架: ComfyUI
- 现有 Sora2 节点: 8个（可直接复用）

---

## 5. 优先级

### P0 - 高优先级（MVP）

1. GLM Chat 对话基础功能
2. 聚鑫平台文生视频功能
3. 聚鑫平台角色创建功能

### P1 - 中优先级

1. GLM 提示词生成/优化功能
2. 聚鑫平台图生视频功能
3. 聚鑫平台批量生成功能

### P2 - 低优先级

1. 故事板功能（待确认）
2. 高级风格配置
3. 自定义模板

---

## 6. 参考文档

- `.dev-docs/可能会用到的skill/glm-coding-skill/` - GLM 编程套餐文档
- `.dev-docs/可能会用到的skill/juxin-platform.md` - 聚鑫平台规范
- `.dev-docs/可能会用到的skill/penguin-nodes-guide.md` - 节点复用指南

---

**文档版本**: v1.0
**创建日期**: 2026-01-21
**维护者**: Penguin-Magic 开发团队
